# 레디스(Redis)


Key, Value 구조의 비정형 데이터를 저장하고 관리하기 위한 오픈 소스 기반의 비관계형 데이터베이스 관리 시스템 (DBMS)이다.  
데이터베이스, 캐시, 메시지 브로커로 사용되며 인메모리 데이터 구조를 가진 저장소이다.

### 데이터베이스가 있는데도 Redis를 사용하는 이유가 뭘까?

데이터베이스는 데이터를 물리 디스크에 직접 쓰기 때문에 서버에 문제가 발생하여 다운되더라도 데이터가 손실되지 않는다. 하지만 매번 디스크에 접근해야 하기 때문에 사용자가 많아질수록 부하가 많아져서 느려질 수 있고, 일반적으로 서비스 운영 초반이거나 규모가 작은, 사용자가 많지 않은 서비스의 경우에는 WEB - WAS - DB 의 구조로도 데이터 베이스에 무리가 가지 않는다.  
<img width="755" alt="스크린샷 2023-01-11 오후 6 15 23" src="https://user-images.githubusercontent.com/70997596/211776589-92936b02-d0bc-45d4-a049-de86bd4b78cf.png">


하지만 사용자가 늘어난다면 데이터 베이스가 과부하 될 수 있기 때문에 이때 캐시 서버를 도입하여 사용한다.  
그리고 이 캐시 서버로 이용할 수 있는 것이 바로 Redis다.

캐시는 한번 읽어온 데이터를 임의의 공간에 저장하여 다음에 읽을 때는 빠르게 결괏값을 받을 수 있도록 도와주는 공간이라 같은 요청이 여러 번 들어오는 경우 매번 데이터 베이스를 거치는 것이 아니라 캐시 서버에서 첫 번째 요청 이후 저장된 결괏값을 바로 내려주기 때문에 DB의 부하를 줄이고 서비스의 속도도 느려지지 않는 장점이 있다.

### 로컬 캐시가 있는데도 Redis를 사용하는 이유가 뭘까?
서버 어플리케이션은 대부분 자체 로컬 캐시를 지원한다. 다만 로컬 캐시는 단일 서버에서만 동작하므로 분산 시스템에서는 로컬캐시가 올바르게 동작하기 힘들다.
Redis 서버를 따로 두어 관리하면 분산 환경에서도 캐시를 원활하게 이용할 수 있다.
또한 북제와 샤딩을 지원하기 때문에 대규모 시스템에서 확장성을 유지할 수 있다. 반면 로컬캐시는 이러한 기능이 없다는 단점이 있다.


### Redis의 특징
- Key, Value 구조이기 때문에 쿼리를 사용할 필요가 없다.  
- 데이터를 디스크에 쓰는 구조가 아니라 메모리에서 데이터를 처리하기 때문에 속도가 빠르다.  
- String, Lists, Sets, Sorted Sets, Hashes 자료 구조를 지원한다.
   
    - String : 가장 일반적인 key - value 구조의 형태

    - Sets : String의 집합. 여러 개의 값을 하나의 value에 넣을 수 있다.

    - Sorted Sets : 중복된 데이터를 담지 않는 Set 구조에 정렬 Sort를 적용한 구조로 랭킹 보드 서버 같은 구현에 사용할 수 있다.

    - Lists : Array 형식의 데이터 구조. List를 사용하면 처음과 끝에 데이터를 넣고 빼는 건 빠르지만 중간에 데이터를 삽입하거나 삭제하는 것은 어렵다.

- Single Threaded 이다.  
  한 번에 하나의 명령만 처리할 수 있다. 그렇기 때문에 중간에 처리 시간이 긴 명령어가 들어오면 그 뒤에 명령어들은 모두 앞에 있는 명령어가 처리될 때까지 대기가 필요하다.  
  (하지만 get, set 명령어의 경우 초당 10만 개 이상 처리할 수 있을 만큼 빠르다.)
 
 

### Redis 사용시 주의할 점
1. 장애 대응
   - 인메모리 데이터 저장소의 특성상, 서버에 장애가 발생했을 경우 데이터 유실이 발생할 수 있다.
     -> 클러스터를 구성해서 복사본을 만들어둔다.
   - 장애가 일어났을 때 레디스를 사용하는 어플리케이션에 장애가 전파될 수 있다.
     -> 서킷브레이커 패턴을 이용해서 장애 전파 차단
     <details>
      <summary>서킷브레이커 패턴</summary>
      <div markdown="1">
     서킷브레이커는 장애가 발생했을 때 단순 예외처리를 하는것이 아니고, 특정 가용률 아래로 떨어지면 잠시동안 아예 시도를 하지 않는다.
     레디스를 예로들면 레디스 서버가 다운되어서 접근이 불가능하면, 잠시 레디스의 접근 자체를 하지 않는 방식으로 장애 전파를 차단한다.
      </div>
      </details>

   
2. 메모리 관리
    - 싱글 스레드의 특성상, 한 번에 하나의 명령만 처리할 수 있기 때문에, 처리하는데 시간이 오래 걸리는 요청, 명령은 피해야 한다.
    - 인메모리 데이터 스토어이므로 메모리 부족현상이 일어날 수 있다.
    - 따라서 하나의 인스턴스에 서버 어플리케이션, db어플리케이션, 레디스를 한 번에 두면 메모리 부족이 일어날 수 있으므로 따로 두는 것이 좋다.
3. 정합성 관리
    - 레디스 뿐만 아니라 캐시를 사용하는 경우, 실제 데이터베이스와는 다른 데이터가 조회될 수 있는 문제가 발생할 수 있다.
    - 비즈니스 요구사항에 맞춰 어느정도까지 실시간성을 맞출지 고려하여 적절하게 설정하는 전략이 필요하다.
  
### 캐시 이외에 Redis가 주로 쓰이는 곳
1.  세션 스토어 : 사용자 세션 정보를 관리
2.  메시지 브로커 : 여러 시스템 간에 메시지를 전달하는 기능
      
